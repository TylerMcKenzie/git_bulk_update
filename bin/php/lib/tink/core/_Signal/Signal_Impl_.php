<?php
/**
 * Generated by Haxe 3.4.7
 */

namespace tink\core\_Signal;

use \tink\core\SignalObject;
use \php\_Boot\HxClosure;
use \tink\core\FutureTrigger;
use \tink\core\_Callback\SimpleLink;
use \tink\core\SignalTrigger;
use \php\Boot;
use \tink\core\_Future\FutureObject;
use \tink\core\_Callback\Callback_Impl_;
use \tink\core\Noise;
use \tink\core\_Callback\LinkPair;
use \tink\core\_Callback\CallbackLink_Impl_;
use \tink\core\_Callback\CallbackList_Impl_;

final class Signal_Impl_ {
	/**
	 * @param \Closure $f
	 * 
	 * @return SignalObject
	 */
	static public function _new ($f) {
		#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:9: character 16
		$this1 = new SimpleSignal($f);
		#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:9: character 16
		return $this1;
	}


	/**
	 * @param \Closure $create
	 * 
	 * @return SignalObject
	 */
	static public function create ($create) {
		#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:129: characters 4-37
		return new Suspendable($create);
	}


	/**
	 *  Creates a new signal whose values will only be emitted when the filter function evalutes to `true`
	 * 
	 * @param SignalObject $this
	 * @param \Closure $f
	 * @param bool $gather
	 * 
	 * @return SignalObject
	 */
	static public function filter ($this1, $f, $gather = true) {
		#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:36: lines 36-41
		if ($gather === null) {
			#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:36: lines 36-41
			$gather = true;
		}
		#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:37: characters 14-110
		$this2 = new SimpleSignal(function ($cb)  use (&$f, &$this1) {
			#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:37: characters 39-109
			return $this1->handle(function ($result)  use (&$f, &$cb) {
				#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:37: characters 76-108
				if ($f($result)) {
					#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:37: characters 91-108
					Callback_Impl_::invoke($cb, $result);
				}
			});
		});
		#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:37: characters 4-111
		$ret = $this2;
		#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:39: lines 39-40
		if ($gather) {
			#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:39: characters 18-30
			return Signal_Impl_::gather($ret);
		} else {
			#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:40: characters 11-14
			return $ret;
		}
	}


	/**
	 *  Creates a new signal by applying a transform function to the result.
	 *  Different from `map`, the transform function of `flatMap` returns a `Future`
	 * 
	 * @param SignalObject $this
	 * @param \Closure $f
	 * @param bool $gather
	 * 
	 * @return SignalObject
	 */
	static public function flatMap ($this1, $f, $gather = true) {
		#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:26: lines 26-31
		if ($gather === null) {
			#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:26: lines 26-31
			$gather = true;
		}
		#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:27: characters 14-98
		$this2 = new SimpleSignal(function ($cb)  use (&$f, &$this1) {
			#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:27: characters 39-97
			return $this1->handle(function ($result)  use (&$f, &$cb) {
				#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:27: characters 76-96
				$f($result)->handle($cb);
			});
		});
		#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:27: characters 4-99
		$ret = $this2;
		#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:29: lines 29-30
		if ($gather) {
			#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:29: characters 18-30
			return Signal_Impl_::gather($ret);
		} else {
			#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:30: characters 11-14
			return $ret;
		}
	}


	/**
	 *  Creates a new signal which stores the result internally.
	 *  Useful for tranformed signals, such as product of `map` and `flatMap`,
	 *  so that the transformation function will not be invoked for every callback
	 * 
	 * @param SignalObject $this
	 * 
	 * @return SignalObject
	 */
	static public function gather ($this1) {
		#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:111: characters 4-24
		$ret = Signal_Impl_::trigger();
		#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:112: characters 4-44
		$this1->handle(function ($x)  use (&$ret) {
			#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:112: characters 29-43
			CallbackList_Impl_::invoke($ret->handlers, $x);
		});
		#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:113: characters 4-25
		return $ret;
	}


	/**
	 * @param \Closure $generator
	 * 
	 * @return SignalObject
	 */
	static public function generate ($generator) {
		#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:117: characters 4-24
		$ret = Signal_Impl_::trigger();
		#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:118: characters 4-26
		$generator(new HxClosure($ret, 'trigger'));
		#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:119: characters 4-14
		return $ret;
	}


	/**
	 *  Creates a new signal by joining `this` and `other`,
	 *  the new signal will be triggered whenever either of the two triggers
	 * 
	 * @param SignalObject $this
	 * @param SignalObject $other
	 * @param bool $gather
	 * 
	 * @return SignalObject
	 */
	static public function join ($this1, $other, $gather = true) {
		#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:57: lines 57-65
		if ($gather === null) {
			#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:57: lines 57-65
			$gather = true;
		}
		#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:58: lines 58-61
		$this2 = new SimpleSignal(function ($cb)  use (&$other, &$this1) {
			#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:60: characters 15-49
			$a = $this1->handle($cb);
			#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:60: characters 15-49
			return new LinkPair($a, $other->handle($cb));
		});
		#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:58: lines 58-61
		$ret = $this2;
		#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:63: lines 63-64
		if ($gather) {
			#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:63: characters 18-30
			return Signal_Impl_::gather($ret);
		} else {
			#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:64: characters 11-14
			return $ret;
		}
	}


	/**
	 *  Creates a new signal by applying a transform function to the result.
	 *  Different from `flatMap`, the transform function of `map` returns a sync value
	 * 
	 * @param SignalObject $this
	 * @param \Closure $f
	 * @param bool $gather
	 * 
	 * @return SignalObject
	 */
	static public function map ($this1, $f, $gather = true) {
		#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:15: lines 15-20
		if ($gather === null) {
			#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:15: lines 15-20
			$gather = true;
		}
		#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:16: characters 14-98
		$this2 = new SimpleSignal(function ($cb)  use (&$f, &$this1) {
			#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:16: characters 39-97
			return $this1->handle(function ($result)  use (&$f, &$cb) {
				#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:16: characters 86-95
				$this3 = $f($result);
				#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:16: characters 76-96
				Callback_Impl_::invoke($cb, $this3);
			});
		});
		#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:16: characters 4-99
		$ret = $this2;
		#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:18: lines 18-19
		if ($gather) {
			#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:18: characters 18-30
			return Signal_Impl_::gather($ret);
		} else {
			#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:19: characters 11-14
			return $ret;
		}
	}


	/**
	 * @param SignalObject $this
	 * @param \Closure $condition
	 * 
	 * @return FutureObject
	 */
	static public function next ($this1, $condition = null) {
		#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:97: characters 4-30
		return Signal_Impl_::nextTime($this1, $condition);
	}


	/**
	 *  Gets the next emitted value as a Future
	 * 
	 * @param SignalObject $this
	 * @param \Closure $condition
	 * 
	 * @return FutureObject
	 */
	static public function nextTime ($this1, $condition = null) {
		#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:71: characters 4-31
		$ret = new FutureTrigger();
		#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:72: lines 72-73
		$link = null;
		#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:72: lines 72-73
		$immediate = false;
		#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:75: lines 75-79
		$link = $this1->handle(function ($v)  use (&$immediate, &$condition, &$link, &$ret) {
			#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:75: lines 75-79
			if (($condition === null) || $condition($v)) {
				#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:76: characters 6-20
				$ret->trigger($v);
				#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:77: lines 77-78
				if ($link === null) {
					#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:77: characters 24-40
					$immediate = true;
				} else if ($link !== null) {
					#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:78: characters 11-24
					$link->cancel();
				}
			}
		});
		#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:81: lines 81-82
		if ($immediate) {
			#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:82: characters 6-19
			if ($link !== null) {
				#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:82: characters 6-19
				$link->cancel();
			}
		}
		#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:84: characters 4-25
		return $ret;
	}


	/**
	 *  Transforms this signal and makes it emit `Noise`
	 * 
	 * @param SignalObject $this
	 * 
	 * @return SignalObject
	 */
	static public function noise ($this1) {
		#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:103: characters 4-41
		return Signal_Impl_::map($this1, function ($_) {
			#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:103: characters 28-40
			return Noise::Noise();
		});
	}


	/**
	 *  Creates a `Signal` from classic signals that has the semantics of `addListener` and `removeListener`
	 *  Example: `var signal = Signal.ofClassical(emitter.addListener.bind(eventType), emitter.removeListener.bind(eventType));`
	 * 
	 * @param \Closure $add
	 * @param \Closure $remove
	 * @param bool $gather
	 * 
	 * @return SignalObject
	 */
	static public function ofClassical ($add, $remove, $gather = true) {
		#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:135: lines 135-145
		if ($gather === null) {
			#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:135: lines 135-145
			$gather = true;
		}
		#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:136: lines 136-140
		$this1 = new SimpleSignal(function ($cb)  use (&$remove, &$add) {
			#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:137: characters 6-40
			$f = function ($a)  use (&$cb) {
				#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:137: characters 27-39
				Callback_Impl_::invoke($cb, $a);
			};
			#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:138: characters 6-12
			$add($f);
			#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:139: characters 6-27
			$this2 = null;
			#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:139: characters 13-24
			$f1 = $remove;
			#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:139: characters 13-24
			$a1 = $f;
			#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:139: characters 6-27
			$this2 = new SimpleLink(function ()  use (&$f1, &$a1) {
				#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:139: characters 13-24
				$f1($a1);
			});
			#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:139: characters 6-27
			return $this2;
		});
		#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:136: lines 136-140
		$ret = $this1;
		#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:143: lines 143-144
		if ($gather) {
			#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:143: characters 18-30
			return Signal_Impl_::gather($ret);
		} else {
			#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:144: characters 11-14
			return $ret;
		}
	}


	/**
	 * @param SignalObject $this
	 * @param \Closure $selector
	 * @param bool $gather
	 * 
	 * @return SignalObject
	 */
	static public function select ($this1, $selector, $gather = true) {
		#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:43: lines 43-51
		if ($gather === null) {
			#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:43: lines 43-51
			$gather = true;
		}
		#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:44: lines 44-47
		$this2 = new SimpleSignal(function ($cb)  use (&$selector, &$this1) {
			#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:44: lines 44-47
			return $this1->handle(function ($result)  use (&$selector, &$cb) {
				#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:44: characters 83-99
				$_g = $selector($result);
				#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:44: characters 83-99
				switch (Boot::dynamicField($_g, 'index')) {
					case 0:
						#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:45: characters 16-17
						$v = $_g->params[0];
						#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:45: characters 20-32
						Callback_Impl_::invoke($cb, $v);
						break;
					case 1:
												break;
				}
			});
		});
		#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:44: lines 44-47
		$ret = $this2;
		#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:49: lines 49-50
		if ($gather) {
			#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:49: characters 18-30
			return Signal_Impl_::gather($ret);
		} else {
			#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:50: characters 11-14
			return $ret;
		}
	}


	/**
	 *  Creates a new `SignalTrigger`
	 * 
	 * @return SignalTrigger
	 */
	static public function trigger () {
		#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:126: characters 4-30
		return new SignalTrigger();
	}


	/**
	 * @param SignalObject $this
	 * @param FutureObject $end
	 * 
	 * @return SignalObject
	 */
	static public function until ($this1, $end) {
		#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:88: lines 88-90
		$ret = new Suspendable(function ($yield)  use (&$this1) {
			#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:89: characters 23-48
			$this2 = $this1->handle($yield);
			#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:89: characters 23-48
			if ($this2 === null) {
				#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:89: characters 23-48
				return new HxClosure(CallbackLink_Impl_::class, 'noop');
			} else {
				#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:89: characters 23-48
				return new HxClosure($this2, 'cancel');
			}
		});
		#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:91: characters 4-24
		$end->handle(Callback_Impl_::fromNiladic(new HxClosure($ret, 'kill')));
		#/home/vagrant/haxelib/tink_core/1,23,0/src/tink/core/Signal.hx:92: characters 4-14
		return $ret;
	}
}


Boot::registerClass(Signal_Impl_::class, 'tink.core._Signal.Signal_Impl_');
